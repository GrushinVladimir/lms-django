{% extends 'lms_cleint/base.html' %}
{% block content %}
<h2>{% if form.instance.pk %}Редактировать предмет{% else %}Создать предмет{% endif %}</h2>
<form method="post">
    {% csrf_token %}
    <div class="form-group">
        {{ form.name.label_tag }}
        {{ form.name }}
    </div>
    <div class="form-group">
        {{ form.teachers.label_tag }}
        {{ form.teachers }}
        <small class="form-text text-muted">Удерживайте Ctrl для выбора нескольких преподавателей</small>
    </div>
    <div class="form-group">
        {{ form.student_groups.label_tag }}
        {{ form.student_groups }}
        <small class="form-text text-muted">Удерживайте Ctrl для выбора нескольких групп</small>
    </div>
    <button type="submit" class="btn btn-primary">Сохранить</button>
    <a href="{% url 'subject_list' course.id %}" class="btn btn-secondary">Отмена</a>
</form>

<script>
$(document).ready(function() {
    $('#id_course').change(function() {
        var courseId = $(this).val();
        $.ajax({
            url: '/get_groups_for_subject/' + courseId + '/',
            type: 'GET',
            success: function(data) {
                var groupsSelect = $('#id_student_groups');
                groupsSelect.empty();
                $.each(data, function(index, group) {
                    groupsSelect.append($('<option>', {
                        value: group.id,
                        text: group.name
                    }));
                });
            }
        });
    });
});
</script>

<!-- В шаблоне формы Chapter -->
<script>
$(document).ready(function() {
    $('#id_subject').change(function() {
        var subjectId = $(this).val();
        $.ajax({
            url: '/get_groups_for_chapter/' + subjectId + '/',
            type: 'GET',
            success: function(data) {
                var groupsSelect = $('#id_student_groups');
                groupsSelect.empty();
                $.each(data, function(index, group) {
                    groupsSelect.append($('<option>', {
                        value: group.id,
                        text: group.name
                    }));
                });
            }
        });
    });
});
</script>
{% endblock %}
