{% extends 'lms_cleint/base.html' %}
{% block content %}
<h2>{% if form.instance.pk %}Редактировать главу{% else %}Создать новую главу{% endif %}</h2>

<form method="post">
    {% csrf_token %}
    <div class="form-group">
        {{ form.name.label_tag }}
        {{ form.name }}
        {% if form.name.errors %}
            <div class="alert alert-danger">{{ form.name.errors }}</div>
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.teachers.label_tag }}
        {{ form.teachers }}
        <small class="form-text text-muted">Удерживайте Ctrl для выбора нескольких преподавателей</small>
        {% if form.teachers.errors %}
            <div class="alert alert-danger">{{ form.teachers.errors }}</div>
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.student_groups.label_tag }}
        {{ form.student_groups }}
        <small class="form-text text-muted">Удерживайте Ctrl для выбора нескольких групп</small>
        {% if form.student_groups.errors %}
            <div class="alert alert-danger">{{ form.student_groups.errors }}</div>
        {% endif %}
    </div>
    
    <button type="submit" class="btn btn-primary">Сохранить</button>
    <a href="{% url 'chapter_list' subject.id %}" class="btn btn-secondary">Отмена</a>
</form>
<script>
$(document).ready(function() {
    $('#id_subject').change(function() {
        var subjectId = $(this).val();
        $.ajax({
            url: '/get_groups_for_chapter/' + subjectId + '/',
            type: 'GET',
            success: function(data) {
                var groupsSelect = $('#id_student_groups');
                groupsSelect.empty();
                $.each(data, function(index, group) {
                    groupsSelect.append($('<option>', {
                        value: group.id,
                        text: group.name
                    }));
                });
            }
        });
    });
});
</script>
{% endblock %}